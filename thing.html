<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <div id="video-container">
      <video preload="auto" autobuffer="true" id="one" width="480" controls>
        <source src="https://r9---sn-p5qlsnes.googlevideo.com/videoplayback?ip=128.59.151.69&fexp=9419451%2C9421733%2C9422596%2C9428398%2C9431012%2C9433043%2C9433096%2C9433223%2C9433946%2C9435526%2C9436050%2C9436847%2C9438327%2C9438662%2C9438817%2C9439553%2C9439580%2C9440172%2C9442424%2C9442426%2C9442796%2C9442914%2C9442958%2C9443116%2C9443264%2C9443403%2C9443604%2C9444144&ms=au&mv=m&mt=1471614506&requiressl=yes&dur=239.072&id=o-AOAXUzUdv9Hy5_7LZ7UDEo9JLNWgauaSC_M199MN-NNw&mn=sn-p5qlsnes&pl=20&mm=31&shardbypass=yes&source=youtube&upn=YhbjZiWG-ss&hcs=yes&ei=sBK3V5z_OaHN8gT2m4UQ&itag=137&key=yt6&mime=video%2Fmp4&nh=IgpwZjAxLmlhZDI2KgszOC4xNDIuNC44MQ&keepalive=yes&gir=yes&clen=98189789&sparams=clen%2Cdur%2Cei%2Cgcr%2Cgir%2Chcs%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Cshardbypass%2Csource%2Cupn%2Cexpire&gcr=us&expire=1471637265&ipbits=0&sver=3&lmt=1466246452697847&initcwndbps=2468750&signature=587D12F548D0015DDF1D0FA25CCA9E166F91FC84.745494B90149B7D9E149BD68E615E9381F340645&ratebypass=yes">
      </video>
      <audio preload="auto" autobuffer="true" id="two" controls>
        <source src="https://r9---sn-p5qlsnes.googlevideo.com/videoplayback?ip=128.59.151.69&fexp=9419451%2C9421733%2C9422596%2C9428398%2C9431012%2C9433043%2C9433096%2C9433223%2C9433946%2C9435526%2C9436050%2C9436847%2C9438327%2C9438662%2C9438817%2C9439553%2C9439580%2C9440172%2C9442424%2C9442426%2C9442796%2C9442914%2C9442958%2C9443116%2C9443264%2C9443403%2C9443604%2C9444144&ms=au&mv=m&mt=1471614506&requiressl=yes&dur=239.061&id=o-AOAXUzUdv9Hy5_7LZ7UDEo9JLNWgauaSC_M199MN-NNw&mn=sn-p5qlsnes&pl=20&mm=31&shardbypass=yes&source=youtube&upn=YhbjZiWG-ss&hcs=yes&ei=sBK3V5z_OaHN8gT2m4UQ&itag=251&key=yt6&mime=audio%2Fwebm&nh=IgpwZjAxLmlhZDI2KgszOC4xNDIuNC44MQ&keepalive=yes&gir=yes&clen=3897019&sparams=clen%2Cdur%2Cei%2Cgcr%2Cgir%2Chcs%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Cshardbypass%2Csource%2Cupn%2Cexpire&gcr=us&expire=1471637265&ipbits=0&sver=3&lmt=1466167962328534&initcwndbps=2468750&signature=45FA10E2F50DDD63F1E7BFFC10FD3DFCFDA27444.53EE0E550F7B5456CB0372A22579DF464981007F&ratebypass=yes">
      </audio>
    </div>
    <script type="text/javascript">
      // Adapted from http://chirls.com/2011/01/13/what-im-working-on-synchronized-videos-in-html5-featuring-ok-go/
      var tracks = [
        document.getElementById('one'),
        document.getElementById('two')
      ];

      var playing = false;
      var seeking_index = -1;
      var seeked_counter = 0;
      var time_controlling_index = 0;

      function seeking(evt) {
        if (seeking_index < 0) {
          pause();
          for (var i = 0; i < tracks.length; i++) {
            if (tracks[i].id === evt.target.id) {
              seeking_index = i;
              break;
            };
          };
        };
      };

      function seeked(evt) {
        if (seeking_index < 0) {
          return;
        } else if (tracks[seeking_index].id !== evt.target.id) {
          seeked_counter--;
        };

        if (!seeked_counter) {
          var target_time = tracks[seeking_index].currentTime;
          for (var i = 0; i < tracks.length; i++) {
            if (
              tracks[i].id != evt.target.id &&
              seeking_index != i &&
              tracks[i].currentTime != target_time
            ) {
              seeked_counter++;
              tracks[i].currentTime = target_time;
            };
          };

          time_controlling_index = seeking_index;

          if (!seeked_counter) {
            seeking_index = -1;
            if (playing) {
              play();
            };
          };
        };
      };

      function play(evt) {
        playing = true;
        for (var i = 0; i < tracks.length; i++) {
          if (tracks[i].paused && tracks[i] != evt.target) {
            if (Math.abs(tracks[i].currentTime - evt.target.currentTime) > 2) {
              if (evt.target.currentTime <= tracks[i].duration) {
                tracks[i].currentTime = evt.target.currentTime;
              } else {
                tracks[i].currentTime = tracks[i].duration;
              };
            };
            tracks[i].play();
          };
        };
      };

      function pause(evt) {
        if (seeking_index < 0) {
          playing = false;
          for (var i = 0; i < tracks.length; i++) {
            if (!tracks[i].paused && (!evt || tracks[i] != evt.target)) {
              tracks[i].pause();
            };
          };
        };
      };

      var last_time_update = 0;

      function checkTime() {
        var now = Date.now();
        if (now - last_time_update < 4000) {
          return;
        };
        var target_time = tracks[time_controlling_index].currentTime;
        for (var i = 0; i < tracks.length; i++) {
          if (!tracks[i].paused) {
            var diff = Math.abs(tracks[i].currentTime - target_time);
            if (diff > 0.3) {
              seeked_counter++;
              tracks[i].currentTime = target_time;
              last_time_update = Date.now();
            };
          };
        };
      };

      function dataunavailable(evt) {
        pause();
      };

      function ended(evt) {
        if (tracks[time_controlling_index] === evt.target) {
          for (var i = 0; i < tracks.length; i++) {
            if (tracks[i] !== evt.target && tracks[i].duration > evt.target.duration) {
              time_controlling_index = i;
              return;
            };
          };
        };
      };

      var checkTime_id = 0;

      // Not sure if this is necessary...
      function setUpVideos(evt) {
        for (var j = 0; j < tracks.length; j++) {
          if (tracks[j].networkState < 2 && evt.target !== tracks[j] && !tracks[j].videoHeight) {
            return;
          };
        };

        for (var j = 0; j < tracks.length; j++) {
          tracks[j].removeEventListener('loadedmetadata', setUpVideos, false);
        };

        if (!checkTime_id) {
          checkTime_id = setInterval(checkTime, 1000);
        };
      };

      document.addEventListener('load', setUpVideos, false);

      for (var i = 0; i < tracks.length; i++) {
        tracks[i].load();
        tracks[i].addEventListener('play', play, false);
        tracks[i].addEventListener('pause', pause, false);
        tracks[i].addEventListener('seeking', seeking, true);
        tracks[i].addEventListener('seeked', seeked, true);
        tracks[i].addEventListener('dataunavailable', dataunavailable, true);
        tracks[i].addEventListener('waiting', dataunavailable, true);
        tracks[i].addEventListener('loadedmetadata', setUpVideos, false);
      };
    </script>
  </body>
</html>
